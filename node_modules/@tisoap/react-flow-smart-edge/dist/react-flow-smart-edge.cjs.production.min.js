"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("react-flow-renderer"),r=require("pathfinding");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(t);function a(){return a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},a.apply(this,arguments)}var i=function(t,e){switch(e){case"top":return{x:t.x,y:t.y-1};case"bottom":return{x:t.x,y:t.y+1};case"left":return{x:t.x-1,y:t.y};case"right":return{x:t.x+1,y:t.y}}},l=function(t,e,r){for(var n=t.getNodeAt(e.x,e.y);!n.walkable;){t.setWalkableAt(n.x,n.y,!0);var o=i(n,r);n=t.getNodeAt(o.x,o.y)}},u=function(t,e,r,n){var o=t.x/n,a=t.y/n,i=e/n,l=r/n;if(i<1)for(;1!==i;)i++,o++;else if(i>1)for(;1!==i;)i--,o--;if(l<1)for(;1!==l;)l++,a++;else if(l>1)for(;1!==l;)l--,a--;return{x:o,y:a}},d=function(t,e,r,n){var o=t.x*n,a=t.y*n,i=e,l=r;if(i<n)for(;i!==n;)i+=n,o-=n;else if(i>n)for(;i!==n;)i-=n,o+=n;if(l<n)for(;l!==n;)l+=n,a-=n;else if(l>n)for(;l!==n;)l-=n,a+=n;return{x:o,y:a}},s=function(t,e){return void 0===e&&(e=10),Math.round(t/e)*e},g=function(t,e){return void 0===e&&(e=10),Math.floor(t/e)*e},f=function(t,e){return void 0===e&&(e=10),Math.ceil(t/e)*e},x=function(t,e){void 0===e&&(e=0);var r=Math.max(Math.round(t),e);return(r=Number.isInteger(r)?r:e)>=e?r:e},h=function(t,e,r){var n="M "+t.x+", "+t.y+" ";return r.forEach((function(t){n+="L "+t[0]+", "+t[1]+" "})),n+="L "+e.x+", "+e.y+" "},y=function(t,e,r){var n=[[t.x,t.y]].concat(r,[[e.x,e.y]]);return c(n)},c=function(t){for(var e=t[0],r=t[0],n="M"+r[0]+","+r[1]+"M",o=0;o<t.length;o++){var a=t[o],i=v(e[0],e[1],a[0],a[1]);n+=" "+i[0]+","+i[1],n+="Q"+a[0]+","+a[1],e=a}var l=t[t.length-1];return n+" "+l[0]+","+l[1]},v=function(t,e,r,n){return[(t-r)/2+r,(e-n)/2+n]},p=function(t,e,n){try{var o=new r.AStarFinder({diagonalMovement:r.DiagonalMovement.Always}).findPath(e.x,e.y,n.x,n.y,t),a=r.Util.smoothenPath(t,o);return 0===o.length||0===a.length?null:{fullPath:o,smoothedPath:a}}catch(t){return null}},m=function(t,e,n){try{var o=new r.AStarFinder({diagonalMovement:r.DiagonalMovement.Never}).findPath(e.x,e.y,n.x,n.y,t),a=r.Util.smoothenPath(t,o);return 0===o.length||0===a.length?null:{fullPath:o,smoothedPath:a}}catch(t){return null}},b=function(t,e,n){try{var o=new r.JumpPointFinder({diagonalMovement:r.DiagonalMovement.Never}).findPath(e.x,e.y,n.x,n.y,t);return 0===o.length||0===o.length?null:{fullPath:o,smoothedPath:o}}catch(t){return null}},E=function(t){var e=t.options,n=void 0===e?{}:e,o=t.nodes,a=void 0===o?[]:o,h=t.sourceX,c=t.sourceY,v=t.targetX,m=t.targetY,b=t.sourcePosition,E=t.targetPosition;try{var M=n.drawEdge,P=void 0===M?y:M,S=n.generatePath,N=void 0===S?p:S,w=n.gridRatio,A=void 0===w?10:w,B=n.nodePadding,k=void 0===B?10:B;A=x(A);var R=function(t,e,r){void 0===e&&(e=2),void 0===r&&(r=2);var n=Number.MIN_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,l=t.map((function(t){var l,u,d=Math.max(t.width||0,1),s=Math.max(t.height||0,1),x=(null==(l=t.positionAbsolute)?void 0:l.x)||0,h=(null==(u=t.positionAbsolute)?void 0:u.y)||0,y={x:x-e,y:h-e},c={x:x-e,y:h+s+e},v={x:x+d+e,y:h-e},p={x:x+d+e,y:h+s+e};return r>0&&(y.x=g(y.x,r),y.y=g(y.y,r),c.x=g(c.x,r),c.y=f(c.y,r),v.x=f(v.x,r),v.y=g(v.y,r),p.x=f(p.x,r),p.y=f(p.y,r)),y.y<i&&(i=y.y),y.x<a&&(a=y.x),p.y>o&&(o=p.y),p.x>n&&(n=p.x),{id:t.id,width:d,height:s,topLeft:y,bottomLeft:c,topRight:v,bottomRight:p}})),u=2*e;n=f(n+u,r),o=f(o+u,r),a=g(a-u,r),i=g(i-u,r);var d={x:a,y:i},s={x:a,y:o},x={x:n,y:i};return{nodeBoxes:l,graphBox:{topLeft:d,bottomLeft:s,topRight:x,bottomRight:{x:n,y:o},width:Math.abs(d.x-x.x),height:Math.abs(d.y-s.y),xMax:n,yMax:o,xMin:a,yMin:i}}}(a,k=x(k),A),_=R.graphBox,X={x:h,y:c,position:b},L={x:v,y:m,position:E},D=function(t,e,n,o,a){void 0===a&&(a=2);var d=t.xMin,g=t.yMin,x=t.height,h=f(t.width,a)/a+1,y=f(x,a)/a+1,c=new r.Grid(h,y);e.forEach((function(t){for(var e=u(t.topLeft,d,g,a),r=u(t.bottomRight,d,g,a),n=e.x;n<r.x;n++)for(var o=e.y;o<r.y;o++)c.setWalkableAt(n,o,!1)}));var v=u({x:s(n.x,a),y:s(n.y,a)},d,g,a),p=u({x:s(o.x,a),y:s(o.y,a)},d,g,a),m=c.getNodeAt(v.x,v.y);l(c,m,n.position);var b=c.getNodeAt(p.x,p.y);l(c,b,o.position);var E=i(m,n.position),M=i(b,o.position);return{grid:c,start:E,end:M}}(_,R.nodeBoxes,X,L,A),F=N(D.grid,D.start,D.end);if(null===F)return null;var Y=F.fullPath,I=P(X,L,F.smoothedPath.map((function(t){var e=d({x:t[0],y:t[1]},_.xMin,_.yMin,A);return[e.x,e.y]}))),O=Y[Math.floor(Y.length/2)],j=d({x:O[0],y:O[1]},_.xMin,_.yMin,A);return{svgPathString:I,edgeCenterX:j.x,edgeCenterY:j.y}}catch(t){return null}},M=["nodes","options"];function P(t){var r=t.nodes,n=t.options,i=function(t,e){if(null==t)return{};var r,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e.indexOf(r=a[n])>=0||(o[r]=t[r]);return o}(t,M),l=i.style,u=i.label,d=i.labelStyle,s=i.labelShowBg,g=i.labelBgStyle,f=i.labelBgPadding,x=i.labelBgBorderRadius,h=i.markerEnd,y=i.markerStart,c=E({sourcePosition:i.sourcePosition,targetPosition:i.targetPosition,sourceX:i.sourceX,sourceY:i.sourceY,targetX:i.targetX,targetY:i.targetY,options:n,nodes:r});if(null===c)return o.default.createElement(n.fallback||e.BezierEdge,a({},i));var v=c.svgPathString,p=null;return!!u&&"string"==typeof u&&(p=o.default.createElement(e.EdgeText,{x:c.edgeCenterX,y:c.edgeCenterY,label:u,labelStyle:d,labelShowBg:s,labelBgStyle:g,labelBgPadding:f,labelBgBorderRadius:x})),o.default.createElement(o.default.Fragment,null,o.default.createElement("path",{style:l,className:"react-flow__edge-path",d:v,markerEnd:h,markerStart:y}),p)}var S={drawEdge:y,generatePath:p,fallback:e.BezierEdge};function N(t){var r=e.useNodes();return o.default.createElement(P,a({},t,{options:S,nodes:r}))}var w={drawEdge:h,generatePath:b,fallback:e.StepEdge},A={drawEdge:h,generatePath:m,fallback:e.StraightEdge};exports.SmartBezierEdge=N,exports.SmartEdge=P,exports.SmartStepEdge=function(t){var r=e.useNodes();return o.default.createElement(P,a({},t,{options:w,nodes:r}))},exports.SmartStraightEdge=function(t){var r=e.useNodes();return o.default.createElement(P,a({},t,{options:A,nodes:r}))},exports.default=N,exports.getSmartEdge=E,exports.pathfindingAStarDiagonal=p,exports.pathfindingAStarNoDiagonal=m,exports.pathfindingJumpPointNoDiagonal=b,exports.svgDrawSmoothLinePath=y,exports.svgDrawStraightLinePath=h;
//# sourceMappingURL=react-flow-smart-edge.cjs.production.min.js.map
